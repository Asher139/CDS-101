---
title: "Assignment 9: Birth Times"
author: "FirstName LastName"
date: "`r Sys.Date()`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    theme: default
    self_contained: true
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    smart: true
    dev: svg
---

```{r setup, include = FALSE}
# DO NOT ALTER THIS CHUNK
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  fig.width = 5,
  fig.asp = 0.618,
  out.width = "70%",
  dpi = 120,
  fig.align = "center",
  cache = FALSE
)
# Load required packages
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(infer))
# Load Cohen's d bootstrap helper functions
load("bootstrap_cohens_d.RData")
# Load dataset
nsfg6 <- read_rds("2002FemPreg.rds")
# Set seed
set.seed(361356566)
```
## Exercise 1
```{r ex1}
live_births <- dplyr::filter(nsfg6, outcome == 1)
pregnancy_length <- dplyr::mutate(
  live_births,
  birth_order = dplyr::if_else(birthord == 1, "first", "other")
) |>
  dplyr::select(prglngth, birth_order)
```

## Exercise 2
```{r ex2, echo=FALSE}
library(ggplot2)

# PMF-style overlapping histograms (binwidth = 1), same plot, transparent
ggplot(pregnancy_length, aes(x = prglngth, fill = birth_order)) +
  geom_histogram(
    aes(y = after_stat(count / sum(count))),
    binwidth = 1,
    position = "identity",
    alpha = 0.5,
    boundary = 0,
    closed = "left"
  ) +
  xlim(27, 46) +
  labs(
    title = "Pregnancy length (weeks): first vs. other births",
    x = "Weeks of gestation",
    y = "Probability (PMF)",
    fill = "Birth order"
  )
```


## Exercise 3
```{r, echo=FALSE}
pregnancy_length %>%
  group_by(birth_order) %>%
  summarize(
    mean = mean(prglngth, na.rm = TRUE),
    median = median(prglngth, na.rm = TRUE),
    sd = sd(prglngth, na.rm = TRUE),
    IQR = IQR(prglngth, na.rm = TRUE),
    min = min(prglngth, na.rm = TRUE),
    max = max(prglngth, na.rm = TRUE)
  )
```

## Exercise 4
```{r, echo=FALSE}
pregnancy_length %>%
  specify(prglngth ~ birth_order) %>%
  hypothesize(null = "independence") %>%
  calculate(stat = "diff in means", order = c("first", "other"))
```
-The test statistic is the difference in average pregnancy length between first and other births.
The null hypothesis says there is no difference between the two groups.
The alternative hypothesis says there is some difference.
I used a two-sided test because the direction of the difference is not known.

## Exercise 5
```{r, echo=FALSE}
# Generate the null distribution using 10,000 simulations
null_dist <- pregnancy_length %>%
  specify(prglngth ~ birth_order) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 10000, type = "permute") %>%
  calculate(stat = "diff in means", order = c("first", "other"))

# Get observed statistic (from Exercise 4)
obs_stat <- 0.0780373  # Replace this if your actual value differs

# Calculate p-value (two-sided test)
p_val <- null_dist %>%
  get_p_value(obs_stat = obs_stat, direction = "two-sided")

p_val

# Visualize the null distribution and observed statistic
null_dist %>%
  visualize() +
  shade_p_value(obs_stat = obs_stat, direction = "two-sided") +
  labs(
    title = "Null Distribution of Difference in Means",
    x = "Difference in mean pregnancy length (weeks)",
    y = "Frequency"
  )
```


## Exercise 6
```{r, echo=FALSE}
birth_bootstraps <- pregnancy_length %>%
  specify(prglngth ~ birth_order) %>%
  generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "diff in means", order = c("first", "other"))

bootstrap_ci <- birth_bootstraps %>%
  get_confidence_interval(level = 0.95, type = "percentile")

bootstrap_ci

obs_stat <- 0.0780373   # replace with your value if different
(obs_stat >= bootstrap_ci$lower) & (obs_stat <= bootstrap_ci$upper)

birth_bootstraps %>%
  visualize() +
  shade_confidence_interval(bootstrap_ci) +
  labs(
    title = "Bootstrap distribution of difference in means (95% CI)",
    x = "Difference in mean pregnancy length (weeks)",
    y = "Frequency"
  )
```


## Exercise 7